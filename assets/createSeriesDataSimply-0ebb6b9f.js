import{c as U,e as y,bs as ut,h as ft,M as S,bt as pt,ad as X,au as vt,bu as ht,bv as mt,bw as dt,bx as it,by as Dt,bz as gt,bA as J,f as q,V as z,K as yt,a9 as It,bB as Ot,i as H,bC as Mt,X as St,I as Y,b as wt,a as Ct,bD as At,bE as Nt,bF as xt,bG as Rt,be as rt,q as nt,bH as Tt,bI as Et,bJ as Lt}from"./installCanvasRenderer-5a1e3a7f.js";function F(r){return r==null?0:r.length||1}function ot(r){return r}var Ft=function(){function r(t,e,i,n,o,s){this._old=t,this._new=e,this._oldKeyGetter=i||ot,this._newKeyGetter=n||ot,this.context=o,this._diffModeMultiple=s==="multiple"}return r.prototype.add=function(t){return this._add=t,this},r.prototype.update=function(t){return this._update=t,this},r.prototype.updateManyToOne=function(t){return this._updateManyToOne=t,this},r.prototype.updateOneToMany=function(t){return this._updateOneToMany=t,this},r.prototype.updateManyToMany=function(t){return this._updateManyToMany=t,this},r.prototype.remove=function(t){return this._remove=t,this},r.prototype.execute=function(){this[this._diffModeMultiple?"_executeMultiple":"_executeOneToOne"]()},r.prototype._executeOneToOne=function(){var t=this._old,e=this._new,i={},n=new Array(t.length),o=new Array(e.length);this._initIndexMap(t,null,n,"_oldKeyGetter"),this._initIndexMap(e,i,o,"_newKeyGetter");for(var s=0;s<t.length;s++){var a=n[s],u=i[a],l=F(u);if(l>1){var f=u.shift();u.length===1&&(i[a]=u[0]),this._update&&this._update(f,s)}else l===1?(i[a]=null,this._update&&this._update(u,s)):this._remove&&this._remove(s)}this._performRestAdd(o,i)},r.prototype._executeMultiple=function(){var t=this._old,e=this._new,i={},n={},o=[],s=[];this._initIndexMap(t,i,o,"_oldKeyGetter"),this._initIndexMap(e,n,s,"_newKeyGetter");for(var a=0;a<o.length;a++){var u=o[a],l=i[u],f=n[u],h=F(l),c=F(f);if(h>1&&c===1)this._updateManyToOne&&this._updateManyToOne(f,l),n[u]=null;else if(h===1&&c>1)this._updateOneToMany&&this._updateOneToMany(f,l),n[u]=null;else if(h===1&&c===1)this._update&&this._update(f,l),n[u]=null;else if(h>1&&c>1)this._updateManyToMany&&this._updateManyToMany(f,l),n[u]=null;else if(h>1)for(var _=0;_<h;_++)this._remove&&this._remove(l[_]);else this._remove&&this._remove(l)}this._performRestAdd(s,n)},r.prototype._performRestAdd=function(t,e){for(var i=0;i<t.length;i++){var n=t[i],o=e[n],s=F(o);if(s>1)for(var a=0;a<s;a++)this._add&&this._add(o[a]);else s===1&&this._add&&this._add(o);e[n]=null}},r.prototype._initIndexMap=function(t,e,i,n){for(var o=this._diffModeMultiple,s=0;s<t.length;s++){var a="_ec_"+this[n](t[s],s);if(o||(i[s]=a),!!e){var u=e[a],l=F(u);l===0?(e[a]=s,o&&i.push(a)):l===1?e[a]=[u,s]:u.push(s)}}},r}();const bt=Ft;var Gt=function(){function r(t,e){this._encode=t,this._schema=e}return r.prototype.get=function(){return{fullDimensions:this._getFullDimensionNames(),encode:this._encode}},r.prototype._getFullDimensionNames=function(){return this._cachedDimNames||(this._cachedDimNames=this._schema?this._schema.makeOutputDimensionNames():[]),this._cachedDimNames},r}();function Pt(r,t){var e={},i=e.encode={},n=U(),o=[],s=[],a={};y(r.dimensions,function(c){var _=r.getDimensionInfo(c),D=_.coordDim;if(D){var O=_.coordDimIndex;Z(i,D)[O]=c,_.isExtraCoord||(n.set(D,1),Ut(_.type)&&(o[0]=c),Z(a,D)[O]=r.getDimensionIndex(_.name)),_.defaultTooltip&&s.push(c)}ut.each(function(x,R){var A=Z(i,R),E=_.otherDims[R];E!=null&&E!==!1&&(A[E]=_.name)})});var u=[],l={};n.each(function(c,_){var D=i[_];l[_]=D[0],u=u.concat(D)}),e.dataDimsOnCoord=u,e.dataDimIndicesOnCoord=ft(u,function(c){return r.getDimensionInfo(c).storeDimIndex}),e.encodeFirstDimNotExtra=l;var f=i.label;f&&f.length&&(o=f.slice());var h=i.tooltip;return h&&h.length?s=h.slice():s.length||(s=o.slice()),i.defaultedLabel=o,i.defaultedTooltip=s,e.userOutput=new Gt(a,t),e}function Z(r,t){return r.hasOwnProperty(t)||(r[t]=[]),r[t]}function Vt(r){return r==="category"?"ordinal":r==="time"?"time":"float"}function Ut(r){return!(r==="ordinal"||r==="time")}var Bt=function(){function r(t){this.otherDims={},t!=null&&S(this,t)}return r}();const W=Bt;var b=Y,C=ft,zt=typeof Int32Array>"u"?Array:Int32Array,Ht="e\0\0",st=-1,$t=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_dimSummary","userOutput","_rawData","_dimValueGetter","_nameDimIdx","_idDimIdx","_nameRepeatCount"],Kt=["_approximateExtent"],at,$,G,P,Q,K,V,Xt=function(){function r(t,e){this.type="list",this._dimOmitted=!1,this._nameList=[],this._idList=[],this._visual={},this._layout={},this._itemVisuals=[],this._itemLayouts=[],this._graphicEls=[],this._approximateExtent={},this._calculationInfo={},this.hasItemOption=!1,this.TRANSFERABLE_METHODS=["cloneShallow","downSample","lttbDownSample","map"],this.CHANGABLE_METHODS=["filterSelf","selectRange"],this.DOWNSAMPLE_METHODS=["downSample","lttbDownSample"];var i,n=!1;pt(t)?(i=t.dimensions,this._dimOmitted=t.isDimensionOmitted(),this._schema=t):(n=!0,i=t),i=i||["x","y"];for(var o={},s=[],a={},u=!1,l={},f=0;f<i.length;f++){var h=i[f],c=X(h)?new W({name:h}):h instanceof W?h:new W(h),_=c.name;c.type=c.type||"float",c.coordDim||(c.coordDim=_,c.coordDimIndex=0);var D=c.otherDims=c.otherDims||{};s.push(_),o[_]=c,l[_]!=null&&(u=!0),c.createInvertedIndices&&(a[_]=[]),D.itemName===0&&(this._nameDimIdx=f),D.itemId===0&&(this._idDimIdx=f),n&&(c.storeDimIndex=f)}if(this.dimensions=s,this._dimInfos=o,this._initGetDimensionInfo(u),this.hostModel=e,this._invertedIndicesMap=a,this._dimOmitted){var O=this._dimIdxToName=U();y(s,function(x){O.set(o[x].storeDimIndex,x)})}}return r.prototype.getDimension=function(t){var e=this._recognizeDimIndex(t);if(e==null)return t;if(e=t,!this._dimOmitted)return this.dimensions[e];var i=this._dimIdxToName.get(e);if(i!=null)return i;var n=this._schema.getSourceDimension(e);if(n)return n.name},r.prototype.getDimensionIndex=function(t){var e=this._recognizeDimIndex(t);if(e!=null)return e;if(t==null)return-1;var i=this._getDimInfo(t);return i?i.storeDimIndex:this._dimOmitted?this._schema.getSourceDimensionIndex(t):-1},r.prototype._recognizeDimIndex=function(t){if(vt(t)||t!=null&&!isNaN(t)&&!this._getDimInfo(t)&&(!this._dimOmitted||this._schema.getSourceDimensionIndex(t)<0))return+t},r.prototype._getStoreDimIndex=function(t){var e=this.getDimensionIndex(t);return e},r.prototype.getDimensionInfo=function(t){return this._getDimInfo(this.getDimension(t))},r.prototype._initGetDimensionInfo=function(t){var e=this._dimInfos;this._getDimInfo=t?function(i){return e.hasOwnProperty(i)?e[i]:void 0}:function(i){return e[i]}},r.prototype.getDimensionsOnCoord=function(){return this._dimSummary.dataDimsOnCoord.slice()},r.prototype.mapDimension=function(t,e){var i=this._dimSummary;if(e==null)return i.encodeFirstDimNotExtra[t];var n=i.encode[t];return n?n[e]:null},r.prototype.mapDimensionsAll=function(t){var e=this._dimSummary,i=e.encode[t];return(i||[]).slice()},r.prototype.getStore=function(){return this._store},r.prototype.initData=function(t,e,i){var n=this,o;if(t instanceof it&&(o=t),!o){var s=this.dimensions,a=ht(t)||mt(t)?new dt(t,s.length):t;o=new it;var u=C(s,function(l){return{type:n._dimInfos[l].type,property:l}});o.initData(a,u,i)}this._store=o,this._nameList=(e||[]).slice(),this._idList=[],this._nameRepeatCount={},this._doInit(0,o.count()),this._dimSummary=Pt(this,this._schema),this.userOutput=this._dimSummary.userOutput},r.prototype.appendData=function(t){var e=this._store.appendData(t);this._doInit(e[0],e[1])},r.prototype.appendValues=function(t,e){var i=this._store.appendValues(t,e.length),n=i.start,o=i.end,s=this._shouldMakeIdFromName();if(this._updateOrdinalMeta(),e)for(var a=n;a<o;a++){var u=a-n;this._nameList[a]=e[u],s&&V(this,a)}},r.prototype._updateOrdinalMeta=function(){for(var t=this._store,e=this.dimensions,i=0;i<e.length;i++){var n=this._dimInfos[e[i]];n.ordinalMeta&&t.collectOrdinalMeta(n.storeDimIndex,n.ordinalMeta)}},r.prototype._shouldMakeIdFromName=function(){var t=this._store.getProvider();return this._idDimIdx==null&&t.getSource().sourceFormat!==Dt&&!t.fillStorage},r.prototype._doInit=function(t,e){if(!(t>=e)){var i=this._store,n=i.getProvider();this._updateOrdinalMeta();var o=this._nameList,s=this._idList,a=n.getSource().sourceFormat,u=a===wt;if(u&&!n.pure)for(var l=[],f=t;f<e;f++){var h=n.getItem(f,l);if(!this.hasItemOption&&gt(h)&&(this.hasItemOption=!0),h){var c=h.name;o[f]==null&&c!=null&&(o[f]=J(c,null));var _=h.id;s[f]==null&&_!=null&&(s[f]=J(_,null))}}if(this._shouldMakeIdFromName())for(var f=t;f<e;f++)V(this,f);at(this)}},r.prototype.getApproximateExtent=function(t){return this._approximateExtent[t]||this._store.getDataExtent(this._getStoreDimIndex(t))},r.prototype.setApproximateExtent=function(t,e){e=this.getDimension(e),this._approximateExtent[e]=t.slice()},r.prototype.getCalculationInfo=function(t){return this._calculationInfo[t]},r.prototype.setCalculationInfo=function(t,e){b(t)?S(this._calculationInfo,t):this._calculationInfo[t]=e},r.prototype.getName=function(t){var e=this.getRawIndex(t),i=this._nameList[e];return i==null&&this._nameDimIdx!=null&&(i=G(this,this._nameDimIdx,e)),i==null&&(i=""),i},r.prototype._getCategory=function(t,e){var i=this._store.get(t,e),n=this._store.getOrdinalMeta(t);return n?n.categories[i]:i},r.prototype.getId=function(t){return $(this,this.getRawIndex(t))},r.prototype.count=function(){return this._store.count()},r.prototype.get=function(t,e){var i=this._store,n=this._dimInfos[t];if(n)return i.get(n.storeDimIndex,e)},r.prototype.getByRawIndex=function(t,e){var i=this._store,n=this._dimInfos[t];if(n)return i.getByRawIndex(n.storeDimIndex,e)},r.prototype.getIndices=function(){return this._store.getIndices()},r.prototype.getDataExtent=function(t){return this._store.getDataExtent(this._getStoreDimIndex(t))},r.prototype.getSum=function(t){return this._store.getSum(this._getStoreDimIndex(t))},r.prototype.getMedian=function(t){return this._store.getMedian(this._getStoreDimIndex(t))},r.prototype.getValues=function(t,e){var i=this,n=this._store;return q(t)?n.getValues(C(t,function(o){return i._getStoreDimIndex(o)}),e):n.getValues(t)},r.prototype.hasValue=function(t){for(var e=this._dimSummary.dataDimIndicesOnCoord,i=0,n=e.length;i<n;i++)if(isNaN(this._store.get(e[i],t)))return!1;return!0},r.prototype.indexOfName=function(t){for(var e=0,i=this._store.count();e<i;e++)if(this.getName(e)===t)return e;return-1},r.prototype.getRawIndex=function(t){return this._store.getRawIndex(t)},r.prototype.indexOfRawIndex=function(t){return this._store.indexOfRawIndex(t)},r.prototype.rawIndexOf=function(t,e){var i=t&&this._invertedIndicesMap[t],n=i[e];return n==null||isNaN(n)?st:n},r.prototype.indicesOfNearest=function(t,e,i){return this._store.indicesOfNearest(this._getStoreDimIndex(t),e,i)},r.prototype.each=function(t,e,i){H(t)&&(i=e,e=t,t=[]);var n=i||this,o=C(P(t),this._getStoreDimIndex,this);this._store.each(o,n?z(e,n):e)},r.prototype.filterSelf=function(t,e,i){H(t)&&(i=e,e=t,t=[]);var n=i||this,o=C(P(t),this._getStoreDimIndex,this);return this._store=this._store.filter(o,n?z(e,n):e),this},r.prototype.selectRange=function(t){var e=this,i={},n=yt(t);return y(n,function(o){var s=e._getStoreDimIndex(o);i[s]=t[o]}),this._store=this._store.selectRange(i),this},r.prototype.mapArray=function(t,e,i){H(t)&&(i=e,e=t,t=[]),i=i||this;var n=[];return this.each(t,function(){n.push(e&&e.apply(this,arguments))},i),n},r.prototype.map=function(t,e,i,n){var o=i||n||this,s=C(P(t),this._getStoreDimIndex,this),a=K(this);return a._store=this._store.map(s,o?z(e,o):e),a},r.prototype.modify=function(t,e,i,n){var o=i||n||this,s=C(P(t),this._getStoreDimIndex,this);this._store.modify(s,o?z(e,o):e)},r.prototype.downSample=function(t,e,i,n){var o=K(this);return o._store=this._store.downSample(this._getStoreDimIndex(t),e,i,n),o},r.prototype.lttbDownSample=function(t,e){var i=K(this);return i._store=this._store.lttbDownSample(this._getStoreDimIndex(t),e),i},r.prototype.getRawDataItem=function(t){return this._store.getRawDataItem(t)},r.prototype.getItemModel=function(t){var e=this.hostModel,i=this.getRawDataItem(t);return new It(i,e,e&&e.ecModel)},r.prototype.diff=function(t){var e=this;return new bt(t?t.getStore().getIndices():[],this.getStore().getIndices(),function(i){return $(t,i)},function(i){return $(e,i)})},r.prototype.getVisual=function(t){var e=this._visual;return e&&e[t]},r.prototype.setVisual=function(t,e){this._visual=this._visual||{},b(t)?S(this._visual,t):this._visual[t]=e},r.prototype.getItemVisual=function(t,e){var i=this._itemVisuals[t],n=i&&i[e];return n??this.getVisual(e)},r.prototype.hasItemVisual=function(){return this._itemVisuals.length>0},r.prototype.ensureUniqueItemVisual=function(t,e){var i=this._itemVisuals,n=i[t];n||(n=i[t]={});var o=n[e];return o==null&&(o=this.getVisual(e),q(o)?o=o.slice():b(o)&&(o=S({},o)),n[e]=o),o},r.prototype.setItemVisual=function(t,e,i){var n=this._itemVisuals[t]||{};this._itemVisuals[t]=n,b(e)?S(n,e):n[e]=i},r.prototype.clearAllVisual=function(){this._visual={},this._itemVisuals=[]},r.prototype.setLayout=function(t,e){b(t)?S(this._layout,t):this._layout[t]=e},r.prototype.getLayout=function(t){return this._layout[t]},r.prototype.getItemLayout=function(t){return this._itemLayouts[t]},r.prototype.setItemLayout=function(t,e,i){this._itemLayouts[t]=i?S(this._itemLayouts[t]||{},e):e},r.prototype.clearItemLayouts=function(){this._itemLayouts.length=0},r.prototype.setItemGraphicEl=function(t,e){var i=this.hostModel&&this.hostModel.seriesIndex;Ot(i,this.dataType,t,e),this._graphicEls[t]=e},r.prototype.getItemGraphicEl=function(t){return this._graphicEls[t]},r.prototype.eachItemGraphicEl=function(t,e){y(this._graphicEls,function(i,n){i&&t&&t.call(e,i,n)})},r.prototype.cloneShallow=function(t){return t||(t=new r(this._schema?this._schema:C(this.dimensions,this._getDimInfo,this),this.hostModel)),Q(t,this),t._store=this._store,t},r.prototype.wrapMethod=function(t,e){var i=this[t];H(i)&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(t),this[t]=function(){var n=i.apply(this,arguments);return e.apply(this,[n].concat(Mt(arguments)))})},r.internalField=function(){at=function(t){var e=t._invertedIndicesMap;y(e,function(i,n){var o=t._dimInfos[n],s=o.ordinalMeta,a=t._store;if(s){i=e[n]=new zt(s.categories.length);for(var u=0;u<i.length;u++)i[u]=st;for(var u=0;u<a.count();u++)i[a.get(o.storeDimIndex,u)]=u}})},G=function(t,e,i){return J(t._getCategory(e,i),null)},$=function(t,e){var i=t._idList[e];return i==null&&t._idDimIdx!=null&&(i=G(t,t._idDimIdx,e)),i==null&&(i=Ht+e),i},P=function(t){return q(t)||(t=t!=null?[t]:[]),t},K=function(t){var e=new r(t._schema?t._schema:C(t.dimensions,t._getDimInfo,t),t.hostModel);return Q(e,t),e},Q=function(t,e){y($t.concat(e.__wrappedMethods||[]),function(i){e.hasOwnProperty(i)&&(t[i]=e[i])}),t.__wrappedMethods=e.__wrappedMethods,y(Kt,function(i){t[i]=St(e[i])}),t._calculationInfo=S({},e._calculationInfo)},V=function(t,e){var i=t._nameList,n=t._idList,o=t._nameDimIdx,s=t._idDimIdx,a=i[e],u=n[e];if(a==null&&o!=null&&(i[e]=a=G(t,o,e)),u==null&&s!=null&&(n[e]=u=G(t,s,e)),u==null&&a!=null){var l=t._nameRepeatCount,f=l[a]=(l[a]||0)+1;u=a,f>1&&(u+="__ec__"+f),n[e]=u}}}(),r}();const qt=Xt;function Wt(r,t){ht(r)||(r=Ct(r)),t=t||{};var e=t.coordDimensions||[],i=t.dimensionsDefine||r.dimensionsDefine||[],n=U(),o=[],s=Jt(r,e,i,t.dimensionsCount),a=t.canOmitUnusedDimensions&&At(s),u=i===r.dimensionsDefine,l=u?Nt(r):xt(i),f=t.encodeDefine;!f&&t.encodeDefaulter&&(f=t.encodeDefaulter(r,s));for(var h=U(f),c=new Rt(s),_=0;_<c.length;_++)c[_]=-1;function D(v){var m=c[v];if(m<0){var d=i[v],I=Y(d)?d:{name:d},p=new W,w=I.name;w!=null&&l.get(w)!=null&&(p.name=p.displayName=w),I.type!=null&&(p.type=I.type),I.displayName!=null&&(p.displayName=I.displayName);var g=o.length;return c[v]=g,p.storeDimIndex=v,o.push(p),p}return o[m]}if(!a)for(var _=0;_<s;_++)D(_);h.each(function(v,m){var d=rt(v).slice();if(d.length===1&&!X(d[0])&&d[0]<0){h.set(m,!1);return}var I=h.set(m,[]);y(d,function(p,w){var g=X(p)?l.get(p):p;g!=null&&g<s&&(I[w]=g,x(D(g),m,w))})});var O=0;y(e,function(v){var m,d,I,p;if(X(v))m=v,p={};else{p=v,m=p.name;var w=p.ordinalMeta;p.ordinalMeta=null,p=S({},p),p.ordinalMeta=w,d=p.dimsDef,I=p.otherDims,p.name=p.coordDim=p.coordDimIndex=p.dimsDef=p.otherDims=null}var g=h.get(m);if(g!==!1){if(g=rt(g),!g.length)for(var tt=0;tt<(d&&d.length||1);tt++){for(;O<s&&D(O).coordDim!=null;)O++;O<s&&g.push(O++)}y(g,function(_t,et){var N=D(_t);if(u&&p.type!=null&&(N.type=p.type),x(nt(N,p),m,et),N.name==null&&d){var L=d[et];!Y(L)&&(L={name:L}),N.name=N.displayName=L.name,N.defaultTooltip=L.defaultTooltip}I&&nt(N.otherDims,I)})}});function x(v,m,d){ut.get(m)!=null?v.otherDims[m]=d:(v.coordDim=m,v.coordDimIndex=d,n.set(m,!0))}var R=t.generateCoord,A=t.generateCoordCount,E=A!=null;A=R?A||1:0;var lt=R||"value";function k(v){v.name==null&&(v.name=v.coordDim)}if(a)y(o,function(v){k(v)}),o.sort(function(v,m){return v.storeDimIndex-m.storeDimIndex});else for(var B=0;B<s;B++){var M=D(B),ct=M.coordDim;ct==null&&(M.coordDim=Zt(lt,n,E),M.coordDimIndex=0,(!R||A<=0)&&(M.isExtraCoord=!0),A--),k(M),M.type==null&&(Tt(r,B)===Et.Must||M.isExtraCoord&&(M.otherDims.itemName!=null||M.otherDims.seriesName!=null))&&(M.type="ordinal")}return Yt(o),new Lt({source:r,dimensions:o,fullDimensionCount:s,dimensionOmitted:a})}function Yt(r){for(var t=U(),e=0;e<r.length;e++){var i=r[e],n=i.name,o=t.get(n)||0;o>0&&(i.name=n+(o-1)),o++,t.set(n,o)}}function Jt(r,t,e,i){var n=Math.max(r.dimensionsDetectedCount||1,t.length,e.length,i||0);return y(t,function(o){var s;Y(o)&&(s=o.dimsDef)&&(n=Math.max(n,s.length))}),n}function Zt(r,t,e){if(e||t.hasKey(r)){for(var i=0;t.hasKey(r+i);)i++;r+=i}return t.set(r,!0),r}function jt(r,t,e,i,n,o){r=r||0;var s=e[1]-e[0];if(n!=null&&(n=T(n,[0,s])),o!=null&&(o=Math.max(o,n??0)),i==="all"){var a=Math.abs(t[1]-t[0]);a=T(a,[0,s]),n=o=T(a,[n,o]),i=0}t[0]=T(t[0],e),t[1]=T(t[1],e);var u=j(t,i);t[i]+=r;var l=n||0,f=e.slice();u.sign<0?f[0]+=l:f[1]-=l,t[i]=T(t[i],f);var h;return h=j(t,i),n!=null&&(h.sign!==u.sign||h.span<n)&&(t[1-i]=t[i]+u.sign*n),h=j(t,i),o!=null&&h.span>o&&(t[1-i]=t[i]+h.sign*o),t}function j(r,t){var e=r[t]-r[1-t];return{span:Math.abs(e),sign:e>0?-1:e<0?1:t?-1:1}}function T(r,t){return Math.min(t[1]!=null?t[1]:1/0,Math.max(t[0]!=null?t[0]:-1/0,r))}function kt(r,t,e){t=q(t)&&{coordDimensions:t}||S({encodeDefine:r.getEncode()},t);var i=r.getSource(),n=Wt(i,t).dimensions,o=new qt(n,r);return o.initData(i,e),o}export{bt as D,qt as S,kt as c,Vt as g,Wt as p,jt as s};
